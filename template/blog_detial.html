<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="http://localhost:8081/css/reset.css" type="text/css">
</head>
<body>
    <h1>dffsfffffffffffffffff</h1>
    <div id="content">

    </div>
    <div class="blog-comments">
            <div class='new-comment'>
                <input class='comment-blog-id' type=hidden value="${id}">
                <input class='comment-author' value="">
                <input class='comment-content' value="">
                <button class='comment-add'>添加评论</button>
        </div>
    </div>
    <div id="comment">

    </div>

</body>
<script>
//此为博客主页
var ajax=function(request){
    var r=new XMLHttpRequest();
    //目前设置成立异步执行，异步时会出现加载的问题，或用getbyId解决
    r.open(request.method,request.url,true);
    if(request.contentType!==undefined){
        r.setRequestHeader('Content-Type', request.contentType);
    }
    r.onreadystatechange=function(){
        if(r.readyState===4){
            request.callback(r.response);
        }
    }
    if(request.method==="GET"){
        r.send();
    }else{
        r.send(request.data);
    }
}
//获取文章内容
var blogAll = function() {
    var request = {
        method: 'GET',
        url: '/api/blog/all',
        //contentType: 'application/json',
        callback: function(response) {
            console.log('响应', response);
            var blogs = JSON.parse(response);
            
            //window.blogs = blogs;
            insertBlogBlog(blogs);
        }
    }
    ajax(request)
}



//增加内容详情
var blogTemplate = function(blog) {
    var id = blog.id
    var title = blog.title
    var author = blog.author
    var d = new Date(blog.created_time * 1000)
    var time = d.toLocaleString()
    var t = `
    <div class="blog-cell">
        <div class="">
            <a class="blog-title" href="detial/${id}" data-id="${id}">
                ${title}
            </a>
        </div>
        <div class="blog-information">
            <span>${author}</span> @ <time>${time}</time>
        </div>
    </div>
    `
    return t
}
//评论已全部获取直接增加评论详情
var commentTemplate=function(comment){
    console.log(comment);
}


var insertBlogBlog = function(blogs) {
    var blogHtml= '';
    var commentHtml='';
    for (var i = 0; i < blogs.length; i++) {
        var id=window.location.search;
        id=id.split("=")[1];
        if(id==blogs[i].id){
        var b = blogs[i]
        var t = blogTemplate(b)
        var bc=b.comments;
        commentHtml=commentTemplate(bc);
        blogHtml= t;
        }

        
    }
    // 把数据写入 直接用覆盖式写入
    var div = document.querySelector('#content');
    var comDiv=document.querySelector('#comment');
    div.innerHTML = blogHtml;
    comDiv.innerHTML=commentHtml;
}
blogAll();
</script>
</html>