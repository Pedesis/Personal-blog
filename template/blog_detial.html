<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="http://localhost:8081/css/reset.css" type="text/css">
    <link rel="stylesheet" href="http://localhost:8081/css/common.css">

</head>

<body>
    <header>
        <a class="blog-name" href="/template/blog_home.html">Pedesis</a>
        <span>blog</span>
    </header>
    <nav>
        <div class="container">
            <ul>
                <li><a href="#">首页</a>
                </li>
                <li><a href="#">前端拾贝</a>
                </li>
                <li><a href="#">技术分享</a>
                </li>
                <li><a href="#">生活笔记</a>
                </li>
                <li><a href="#">关于我</a>
                </li>
            </ul>
            <div class="nav-input">
                <input type="search" placeholder="搜索">
                <img src="http://localhost:8081/images/search.png" alt="">
            </div>
        </div>
    </nav>
    <div class="main">
        <div class="container">
            <div class="main-left">
                <div id="comment-content">
                </div>
                <div class="blog-comments">
                    <div class='new-comment'>
                        <input class='comment-blog-id' type=hidden value="${id}">
                        <input class='comment-author' value="">
                        <input class='comment-content' value="">
                        <button class='comment-add'>添加评论</button>
                    </div>
                </div>
                <div id="comment">
                </div>
            </div>
        <div class="main-right">
            <div class="link-me beside-item">
                <h3>关注我</h3>
                <ul class="clearfix item-l">
                    <li><a href="#"><img src="http://localhost:8081/images/link-icon1.png" alt="" srcset="">邮箱</a></li>
                    <li><a href="#"><img src="http://localhost:8081/images/link-icon2.png" alt="" srcset="">微博</a></li>
                    <li><a href="#"><img src="http://localhost:8081/images/link-icon3.png" alt="" srcset="">微信</a></li>
                    <li><a href="#"><img src="http://localhost:8081/images/link-icon4.png" alt="" srcset="">QQ</a></li>
                </ul>
            </div>
            <div class="recent-posts beside-item">
                <h3>最新文章</h3>
                <ol class="item-l" id="new-articles">
                    <li>
                        <div class="dot"></div><a href="#">规定有序列表的起始值。</a>
                    </li>
                    <li>
                        <div class="dot"></div><a href="#">规定有序列表的起始值。</a>
                    </li>
                    <li>
                        <div class="dot"></div><a href="#">规定有序列表的起始值。</a>
                    </li>
                    <li>
                        <div class="dot"></div><a href="#">规定有序列表的起始值。</a>
                    </li>
                    <li>
                        <div class="dot"></div><a href="#">规定有序列表的起始值。</a>
                    </li>
                </ol>
            </div>
        </div>
    </div>
    </div>
</div>
<div class="toTop">
        <img src="/images/top.png">
    </div>
</body>
<script src="http://localhost:8081/js/blogCommon.js"></script>
<script>
    //此为博客主页
    var ajax = function (request) {
        var r = new XMLHttpRequest();
        //目前设置成立异步执行，异步时会出现加载的问题，或用getbyId解决
        r.open(request.method, request.url, true);
        if (request.contentType !== undefined) {
            r.setRequestHeader('Content-Type', request.contentType);
        }
        r.onreadystatechange = function () {
            if (r.readyState === 4) {
                request.callback(r.response);
            }
        }
        if (request.method === "GET") {
            r.send();
        } else {
            r.send(request.data);
        }
    }
    //获取文章内容
    var blogAll = function () {
        var request = {
            method: 'GET',
            url: '/api/blog/all',
            //contentType: 'application/json',
            callback: function (response) {
                console.log('响应', response);
                var blogs = JSON.parse(response);

                //window.blogs = blogs;
                insertBlogBlog(blogs);
            }
        }
        ajax(request)
    }



    //增加内容详情
    var blogTemplate = function (blog) {
        var id = blog.id;
        var title = blog.title;
        var author = blog.author;
        var content = blog.content;
        var d = new Date(blog.created_time * 1000)
        var time = d.toLocaleString()
        var t = `
    <div class="blog-cell">
        <div class="">
            <a class="blog-title" href="detial/${id}" data-id="${id}">
                ${title}
            </a>
        </div>
        <div class="blog-information">
            <div>${content}</div>
            <span>${author}</span> @ <time>${time}</time>
        </div>
    </div>
    `
        return t
    }
    //评论已全部获取直接增加评论详情
    var commentTemplate = function (comment) {
        console.log(comment);
    }


    var insertBlogBlog = function (blogs) {
        var blogHtml = '';
        var commentHtml = '';
        for (var i = 0; i < blogs.length; i++) {
            var id = window.location.search;
            id = id.split("=")[1];
            if (id == blogs[i].id) {
                var b = blogs[i]
                var t = blogTemplate(b)
                var bc = b.comments;
                commentHtml = commentTemplate(bc);
                blogHtml = t;
            }


        }
        // 把数据写入 直接用覆盖式写入
        var div = document.querySelector('#comment-content');
        var comDiv = document.querySelector('#comment');
        div.innerHTML = blogHtml;
        comDiv.innerHTML = commentHtml;
    }
    blogAll();
</script>

</html>